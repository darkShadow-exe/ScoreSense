<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Commands - ScoreSense</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles_m3.css') }}">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <h1 class="logo">
                <span class="material-symbols-outlined">analytics</span>
                ScoreSense
            </h1>
            <ul class="nav-menu">
                <li><a href="/">Dashboard</a></li>
                <li><a href="/students">Students</a></li>
                <li><a href="/stats">Statistics</a></li>
                <li><a href="/command" class="active">Commands</a></li>
                <li>
                    <button id="theme-toggle" class="theme-toggle" onclick="toggleDarkMode()" title="Toggle dark mode">
                        <span class="material-symbols-outlined">dark_mode</span>
                    </button>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="page-header">
            <h2>
                <span class="material-symbols-outlined">chat</span>
                Natural Language Commands
            </h2>
            <p>Interact with the system using plain English or voice</p>
        </div>

        <div class="card">
            <form method="POST" action="/command">
                <div class="form-group">
                    <label for="command">Enter Your Command</label>
                    <div class="command-input-wrapper">
                        <textarea id="command" name="command" rows="3" 
                                  placeholder="Type or speak a command like: 'Add student Sarah in grade 10 section A' or 'Add exam for Sarah: Midterm with math 92, physics 88'"
                                  required></textarea>
                        <button type="button" id="mic-btn" class="mic-button" title="Click to speak">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                    </div>
                    <div id="speech-status" class="speech-status"></div>
                </div>
                <button type="submit" class="btn btn-primary">üöÄ Execute Command</button>
            </form>
        </div>

        {% if result %}
        <div class="card result-card">
            <h3>Result</h3>
            
            {% if result.error %}
            <div class="alert alert-error">
                {{ result.error }}
            </div>
            
            {% elif result.success %}
            <div class="alert alert-success">
                <strong>Success!</strong> {{ result.message }}
            </div>

            {% if result.student %}
            <div class="result-details">
                <h4>Student Details:</h4>
                <p><strong>Name:</strong> {{ result.student.name }}</p>
                {% if result.student.marks %}
                <p><strong>Marks:</strong></p>
                <ul>
                    {% for subject, score in result.student.marks.items() %}
                    <li>{{ subject|capitalize }}: {{ score }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                {% if result.rank %}
                <p><strong>Rank:</strong> {{ result.rank.rank }} / {{ result.rank.total }}</p>
                <p><strong>Average:</strong> {{ result.rank.average }}</p>
                {% endif %}
            </div>
            {% endif %}

            {% if result.topper %}
            <div class="result-details">
                <h4>üèÜ Topper Information:</h4>
                <p><strong>Name:</strong> {{ result.topper.name }}</p>
                {% if result.topper.subject %}
                <p><strong>Subject:</strong> {{ result.topper.subject }}</p>
                <p><strong>Score:</strong> {{ result.topper.score }}</p>
                {% else %}
                <p><strong>Average:</strong> {{ result.topper.average }}</p>
                {% endif %}
            </div>
            {% endif %}

            {% if result.prediction %}
            <div class="result-details prediction-result">
                <h4>üîÆ Prediction Results:</h4>
                <p><strong>Student:</strong> {{ result.student }}</p>
                <p><strong>Subject:</strong> {{ result.subject|capitalize }}</p>
                <p><strong>Predicted Score:</strong> <span class="highlight">{{ result.prediction.predicted_score }}</span></p>
                <p><strong>Confidence:</strong> 
                    <span class="badge badge-{{ result.prediction.confidence }}">
                        {{ result.prediction.confidence|upper }}
                    </span>
                </p>
                <p><strong>Method:</strong> {{ result.prediction.method }}</p>
                {% if result.prediction.trend %}
                <p><strong>Trend:</strong> 
                    <span class="trend-{{ result.prediction.trend }}">{{ result.prediction.trend|capitalize }}</span>
                </p>
                {% endif %}
                <p class="info-text">{{ result.prediction.message }}</p>
            </div>
            {% endif %}

            {% if result.comparisons %}
            <div class="result-details">
                <h4>üìä Comparison Results - {{ result.subject|capitalize }}</h4>
                {% if result.average %}
                <p><strong>Class Average:</strong> {{ result.average }}</p>
                {% endif %}
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Student</th>
                            <th>Score</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for comp in result.comparisons %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ comp.name }}</td>
                            <td><span class="score-badge">{{ comp.score }}</span></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}

            {% if result.stats %}
            <div class="result-details">
                <h4>üìà Class Statistics:</h4>
                <p><strong>Total Students:</strong> {{ result.stats.total_students }}</p>
                <p><strong>Class Average:</strong> {{ result.stats.class_average }}</p>
                {% if result.stats.topper %}
                <p><strong>Topper:</strong> {{ result.stats.topper.name }} ({{ result.stats.topper.average }})</p>
                {% endif %}
            </div>
            {% endif %}

            {% endif %}
        </div>
        {% endif %}

        {% if error %}
        <div class="alert alert-error">
            {{ error }}
        </div>
        {% endif %}

        <div class="card">
            <h3>üí° Example Commands</h3>
            <div class="examples-grid">
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Add student John in grade 10 section A</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Add exam for John: Midterm with math 90, physics 85, chemistry 88</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Add student Sarah in grade 11 section B age 16</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Add exam for Sarah: Finals with math 95, physics 92</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Show class topper</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Show topper in math</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Predict Alice's math score</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Predict Grace's physics score</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Compare scores in biology</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Show class average</code>
                </div>
                <div class="example-item" onclick="fillCommand(this.textContent)">
                    <code>Delete Tom</code>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üìñ Command Guide</h3>
            <div class="guide-list">
                <div class="guide-item">
                    <strong>Add Student Profile:</strong>
                    <span>"Add student [Name] in grade [Grade] section [Section]"</span>
                </div>
                <div class="guide-item">
                    <strong>Add Exam:</strong>
                    <span>"Add exam for [Name]: [Exam Name] with [Subject] [Score], [Subject] [Score]"</span>
                </div>
                <div class="guide-item">
                    <strong>Update Profile:</strong>
                    <span>"Update [Name] with email [Email]" or "Update [Name] with grade [Grade]"</span>
                </div>
                <div class="guide-item">
                    <strong>Delete Student:</strong>
                    <span>"Delete [Name]"</span>
                </div>
                <div class="guide-item">
                    <strong>Show Topper:</strong>
                    <span>"Show class topper" or "Show topper in [Subject]"</span>
                </div>
                <div class="guide-item">
                    <strong>Predict Score:</strong>
                    <span>"Predict [Name]'s [Subject] score"</span>
                </div>
                <div class="guide-item">
                    <strong>Compare Scores:</strong>
                    <span>"Compare scores in [Subject]"</span>
                </div>
                <div class="guide-item">
                    <strong>Show Statistics:</strong>
                    <span>"Show class average" or "Show stats"</span>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        function fillCommand(text) {
            document.getElementById('command').value = text.trim();
        }
    </script>

    <footer>
        <p>Score Analyser ¬© 2025</p>
    </footer>
</body>
</html>
